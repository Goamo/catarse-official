<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–†–∏—Å–æ–≤–∞–Ω–∏–µ –≤ 2D –∏ 3D</title>
  <style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f0f0;
    padding: 20px;
  }
  .layers-panel {
    position: relative;
    width: 300px;
    height: 400px;
    background: #fff;
    border: 1px solid #ccc;
    padding: 20px;
    padding-bottom: 60px; /* –º–µ—Å—Ç–æ –¥–ª—è –∏–∫–æ–Ω–∫–∏ */
    box-sizing: border-box;
  }
  .layers-content {
    overflow-y: auto;
    height: 100%;
  }
  .layers-content ul {
    padding-left: 20px;
  }
  .github-link {
    position: absolute;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    color: #333;
    cursor: pointer;
    display: flex;
    align-items: center;
    text-decoration: none;
  }
  .github-link:hover {
    color: #000;
  }
  .github-link svg {
    width: 24px;
    height: 24px;
    fill: currentColor;
    display: block;
  }
</style>
  <link rel="stylesheet" href="styles.css" />

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
  <script type="module">
    // === –ò–º–ø–æ—Ä—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ===
    import {
      toggleBrushDropdown,
      toggleBrushSettings,
      toggleMeshDropdown,
      setBrushType,
      updateBrushThickness,
      setColor,
      updateOpacity,
      updateBrightness,
      updateContrast
    } from './toolbar.js';

    import { toggleDrawingMode } from './controls.js';
    import { addLayer, removeLayer } from './layers.js';
    import { undo, redo } from './brushTools.js';
    import { insertPrimitive } from './primitives.js';

    // === –ì–ª–æ–±–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π ===
    window.toggleBrushDropdown = toggleBrushDropdown;
    window.toggleBrushSettings = toggleBrushSettings;
    window.toggleMeshDropdown = toggleMeshDropdown;
    window.setBrushType = setBrushType;
    window.updateBrushThickness = updateBrushThickness;
    window.setColor = setColor;
    window.updateOpacity = updateOpacity;
    window.updateBrightness = updateBrightness;
    window.updateContrast = updateContrast;
    window.toggleDrawingMode = toggleDrawingMode;
    window.addLayer = addLayer;
    window.removeLayer = removeLayer;
    window.undo = undo;
    window.redo = redo;
    window.insertPrimitive = insertPrimitive;

    // === –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–Ω–≤–∞—Å–∞ ===
function saveCanvasAsImage() {
  // –ü–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ renderer
  const renderer = window.renderer; // —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ renderer —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
  if (!renderer) {
    alert('Renderer –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    return;
  }

  const canvas = renderer.domElement;
  if (!canvas) {
    alert('Canvas –æ—Ç renderer –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    return;
  }

  const link = document.createElement('a');
  link.download = 'canvas_snapshot.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
}

    // –ì–ª–æ–±–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    window.saveCanvasAsImage = saveCanvasAsImage;
  </script>
</head>
<body>
  <div id="toolbar">
    <div id="mouseIndicator" style="display: none;">–†–µ–∂–∏–º: –†–∏—Å–æ–≤–∞–Ω–∏–µ</div>

    <!-- –ö–∏—Å—Ç—å -->
    <button id="brushButton" onclick="toggleBrushDropdown()" title="–ö–∏—Å—Ç—å">üñåÔ∏è</button>
    <div id="brushDropdown" class="settings-menu">
      <span class="close-btn" onclick="toggleBrushDropdown()">√ó</span>
      <div class="brush-item" data-brush-type="round" onclick="setBrushType('round')" title="–ö—Ä—É–≥–ª–∞—è –∫–∏—Å—Ç—å">‚ö´</div>
      <div class="brush-item" data-brush-type="square" onclick="setBrushType('square')" title="–ö–≤–∞–¥—Ä–∞—Ç–Ω–∞—è –∫–∏—Å—Ç—å">‚¨õ</div>
      <div class="brush-item" data-brush-type="spray" onclick="setBrushType('spray')" title="–°–ø—Ä–µ–π">üí®</div>
      <div class="brush-item" data-brush-type="watercolor" onclick="setBrushType('watercolor')" title="–ê–∫–≤–∞—Ä–µ–ª—å">üíß</div>
      <div class="brush-item" data-brush-type="oil" onclick="setBrushType('oil')" title="–ú–∞—Å–ª—è–Ω–∞—è –∫—Ä–∞—Å–∫–∞">üé®</div>
      <div class="brush-item" data-brush-type="eraser" onclick="setBrushType('eraser')" title="–õ–∞—Å—Ç–∏–∫">‚å´</div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∏—Å—Ç–∏ -->
    <button onclick="toggleBrushSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
    <div id="brushSettingsDropdown" class="settings-menu">
      <span class="close-btn" onclick="toggleBrushSettings()">√ó</span>
      <div>
        <label for="brushThicknessSetting">üìè –¢–æ–ª—â–∏–Ω–∞:</label>
        <input type="range" id="brushThicknessSetting" min="1" max="20" value="10"
               onchange="updateBrushThickness(this.value)" />
      </div>
      <div>
        <label for="colorPickerSetting">üé® –¶–≤–µ—Ç:</label>
        <input type="color" id="colorPickerSetting" value="#000000"
               onchange="setColor(this.value)" />
      </div>
      <div>
        <label for="opacitySetting">üëÅÔ∏è –ù–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</label>
        <input type="range" id="opacitySetting" min="0" max="100" value="100"
               onchange="updateOpacity(this.value)" />
      </div>
      <div>
        <label for="brightnessSetting">‚òÄÔ∏è –Ø—Ä–∫–æ—Å—Ç—å:</label>
        <input type="range" id="brightnessSetting" min="-100" max="100" value="0"
               onchange="updateBrightness(this.value)" />
      </div>
      <div>
        <label for="contrastSetting">‚óê –ö–æ–Ω—Ç—Ä–∞—Å—Ç:</label>
        <input type="range" id="contrastSetting" min="-100" max="100" value="0"
               onchange="updateContrast(this.value)" />
      </div>
    </div>

    <!-- –ü—Ä–∏–º–∏—Ç–∏–≤—ã -->
    <button id="meshButton" onclick="toggleMeshDropdown()" title="–ü—Ä–∏–º–∏—Ç–∏–≤—ã">üìê</button>
    <div id="meshCategorySelect" class="settings-menu" style="display: none;">
      <span class="close-btn" onclick="toggleMeshDropdown()">√ó</span>
      <div style="margin: 10px 0; font-weight: bold;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤:</div>
      <button onclick="showMeshList('2D')">2D</button>
      <button onclick="showMeshList('3D')">3D</button>
    </div>
    <div id="meshDropdown" class="settings-menu" style="display: none; max-height: 60vh; overflow-y: auto;">
      <span class="close-btn" onclick="toggleMeshDropdown()">√ó</span>
    </div>

    <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ 2D/3D -->
    <button id="toggleModeButton" onclick="toggleDrawingMode()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º">üîÑ</button>
  </div>

  <button onclick="saveCanvasAsImage()" style="position: absolute; top: 10px; right: 10px; z-index: 10;">
    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
  </button>

  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–º–µ—Ä—ã -->
  <div id="cameraPositionDisplay"
       style="position:fixed; top:10px; left:10px; padding:6px 12px;
              background:#007aff; color:#fff; font-family:monospace;
              font-size:12px; z-index:1000; border-radius:4px;">
  </div>

  <!-- –ü–∞–Ω–µ–ª—å —Å–ª–æ—ë–≤ -->
  <div id="layerPanel" style="position:fixed; top:60px; right:10px; width:200px;
                              background:#f0f0f0; padding:10px; border-radius:4px;
                              box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    <button onclick="addLayer()" title="–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π</button>
    <button onclick="removeLayer()" title="–£–¥–∞–ª–∏—Ç—å —Å–ª–æ–π">‚ûñ –£–¥–∞–ª–∏—Ç—å —Å–ª–æ–π</button>
    <button id="undoButton" onclick="undo()" title="–û—Ç–º–µ–Ω–∏—Ç—å">‚Ü©Ô∏è –û—Ç–º–µ–Ω–∏—Ç—å</button>
    <button id="redoButton" onclick="redo()" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å">‚Ü™Ô∏è –ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
    <div class="layer-list" id="layerList" style="margin:10px 0; max-height:150px; overflow-y:auto;"></div>

    <div id="objectPanel" style="margin-top:1em;">
      <h4>üìë –û–±—ä–µ–∫—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ—è</h4>
      <ul id="objectList" style="list-style:none; padding-left:0;
                                 max-height:150px; overflow-y:auto; margin:0;">
        <li>‚Äî –ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ ‚Äî</li>
      </ul>
    </div>
    <a href="https://github.com/Goamo/Catarse" target="_blank" rel="noopener noreferrer" class="github-link" aria-label="GitHub Repository">
    <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8a8 8 0 005.47 7.59c.4.07.55-.17.55-.38
        0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01
        1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95
        0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.68 7.68 0 012-.27c.68.003
        1.36.092 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15
        0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01
        8.01 0 0016 8c0-4.42-3.58-8-8-8z"/>
    </svg>
  </a>

  </div>

  <!-- –ö–∞–Ω–≤–∞—Å -->
  <canvas id="unifiedCanvas" style="width:100%; height:100vh; display:block;"></canvas>

  <!-- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <script type="module" src="index.js"></script>
</body>
</html>
