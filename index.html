<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Рисование в 2D и 3D</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="toolbar">
    <div id="mouseIndicator" style="display: none;">Режим: Рисование</div>

    <!-- Кисть -->
    <button id="brushButton" onclick="toggleBrushDropdown()">Кисть</button>
    <div id="brushDropdown" class="settings-menu">
      <span class="close-btn" onclick="toggleBrushDropdown()">❌</span>
      <div class="brush-item" data-brush-type="round" onclick="setBrushType('round')">Круглая</div>
      <div class="brush-item" data-brush-type="square" onclick="setBrushType('square')">Квадратная</div>
      <div class="brush-item" data-brush-type="spray" onclick="setBrushType('spray')">Спрей</div>
      <div class="brush-item" data-brush-type="watercolor" onclick="setBrushType('watercolor')">Акварель</div>
      <div class="brush-item" data-brush-type="oil" onclick="setBrushType('oil')">Масляная краска</div>
      <div class="brush-item" data-brush-type="eraser" onclick="setBrushType('eraser')">Ластик</div>
    </div>

    <!-- Настройки кисти -->
    <button onclick="toggleBrushSettings()">Настройки</button>
    <div id="brushSettingsDropdown" class="settings-menu">
      <span class="close-btn" onclick="toggleBrushSettings()">❌</span>
      <div>
        <label for="brushThicknessSetting">Толщина кисти:</label>
        <input type="range" id="brushThicknessSetting" min="1" max="20" value="10"
               onchange="updateBrushThickness(this.value)" />
      </div>
      <div>
        <label for="colorPickerSetting">Цвет:</label>
        <input type="color" id="colorPickerSetting" value="#000000"
               onchange="setColor(this.value)" />
      </div>
      <div>
        <label for="opacitySetting">Непрозрачность:</label>
        <input type="range" id="opacitySetting" min="0" max="100" value="100"
               onchange="updateOpacity(this.value)" />
      </div>
      <div>
        <label for="brightnessSetting">Яркость:</label>
        <input type="range" id="brightnessSetting" min="-100" max="100" value="0"
               onchange="updateBrightness(this.value)" />
      </div>
      <div>
        <label for="contrastSetting">Контраст:</label>
        <input type="range" id="contrastSetting" min="-100" max="100" value="0"
               onchange="updateContrast(this.value)" />
      </div>
    </div>

    <!-- Примитивы -->
    <button id="meshButton" onclick="toggleMeshDropdown()">Примитивы</button>
    <div id="meshDropdown" class="settings-menu">
      <span class="close-btn" onclick="toggleMeshDropdown()">❌</span>
      <label for="primitiveColor" style="display:block; margin-top:10px;">Цвет фигуры:</label>
      <input type="color" id="primitiveColor" value="#0077ff"
             style="margin-bottom:10px;" />

      <div style="margin-top:10px; font-weight:bold;">3D Примитивы</div>
      <div class="mesh-item" onclick="insertPrimitive('cube')">Куб</div>
      <div class="mesh-item" onclick="insertPrimitive('sphere')">Сфера</div>
      <div class="mesh-item" onclick="insertPrimitive('cylinder')">Цилиндр</div>
      <div class="mesh-item" onclick="insertPrimitive('cone')">Конус</div>
      <div class="mesh-item" onclick="insertPrimitive('torus')">Тор</div>
      <div class="mesh-item" onclick="insertPrimitive('plane')">Плоскость</div>

      <div style="margin-top:15px; font-weight:bold;">2D Примитивы</div>
      <div class="mesh-item" onclick="insertPrimitive('square')">Квадрат</div>
      <div class="mesh-item" onclick="insertPrimitive('rectangle')">Прямоугольник</div>
      <div class="mesh-item" onclick="insertPrimitive('triangle')">Треугольник</div>
      <div class="mesh-item" onclick="insertPrimitive('equilateralTriangle')">Равносторонний треугольник</div>
      <div class="mesh-item" onclick="insertPrimitive('circle')">Круг</div>
      <div class="mesh-item" onclick="insertPrimitive('ellipse')">Эллипс</div>
      <div class="mesh-item" onclick="insertPrimitive('star')">Звезда</div>
      <div class="mesh-item" onclick="insertPrimitive('hexagon')">Шестиугольник</div>
      <div class="mesh-item" onclick="insertPrimitive('semicircle')">Полукруг</div>
      <div class="mesh-item" onclick="insertPrimitive('ring')">Кольцо</div>
    </div>

    <!-- Переключение 2D/3D -->
    <button id="toggleModeButton" onclick="toggleDrawingMode()">Переключить на 3D</button>
  </div>

  <!-- Индикатор позиции камеры -->
  <div id="cameraPositionDisplay"
       style="position:fixed; top:10px; left:10px; padding:6px 12px;
              background:rgba(0,0,0,0.7); color:#fff; font-family:monospace;
              font-size:12px; z-index:1000; border-radius:4px;">
  </div>

  <!-- Панель слоёв и объектов -->
  <div id="layerPanel" style="position:fixed; top:60px; right:10px; width:200px;
                              background:#f0f0f0; padding:10px; border-radius:4px;
                              box-shadow:0 2px 6px rgba(0,0,0,0.2);">
    <button onclick="addLayer()">Добавить слой</button>
    <button onclick="removeLayer()">Удалить слой</button>
    <button id="undoButton" onclick="undo()">↩️</button>
    <button id="redoButton" onclick="redo()">↪️</button>
    <div class="layer-list" id="layerList" style="margin:10px 0; max-height:150px; overflow-y:auto;"></div>

    <!-- Список объектов текущего слоя -->
    <div id="objectPanel" style="margin-top:1em;">
      <h4>Объекты текущего слоя</h4>
      <ul id="objectList" style="list-style:none; padding-left:0;
                                 max-height:150px; overflow-y:auto; margin:0;">
        <li>— Нет объектов —</li>
      </ul>
    </div>
  </div>

  <!-- Canvas -->
  <canvas id="unifiedCanvas" style="width:100%; height:100vh; display:block;"></canvas>

  <!-- Зависимости -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.rawgit.com/mrdoob/three.js/r128/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three-mesh-line@1.3.0/src/THREE.MeshLine.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

  <!-- Ваш главный модуль -->
  <script type="module" src="index.js"></script>
</body>
</html>
